$(function(){cms.init()});var cms={init:function(){cms.apiPath="../brooklyn/_panel/api.php",cms.jsContainer=$(".js-container"),cms.validate=!0,cms.jsContainer.load("/article/",function(){cms.placeDescTooltip()}),this.loginIn(),this.saveSettings(),this.saveContent(),this.setContainerWidth(),this.createNewContent(),this.editContent(),this.saveEditedContent(),this.suggetsId(),$("body").on("click",".js-create",function(){cms.placeDescTooltip(),$(".js-create-new").fadeIn(200),$(".overlay").fadeIn(150)}),$("nav li.js-page a").on("click",function(t){var e=$(this).attr("href");cms.changePage(e),t.preventDefault()}),$(".js-parent").on("hover",function(t){$(this).find(".ul-child").stop().slideToggle(250),t.preventDefault()}),$("body").on("mouseenter mouseleave",".js-show-desc",function(t){cms.placeDescTooltip(),$(this).next().toggle(),t.preventDefault()}),$(".js-close").on("click",function(){$(".js-create-new, .js-edit-content").fadeOut(200),cms.jsContainer.find("li.editing").removeClass("editing"),$(".overlay").fadeOut(150)}),$(".js-delete-btn").on("click",function(){var t=cms.jsContainer.find("li.editing"),e=t.data("articleid");cms.deleteArticle(e),t.remove(),$(".overlay").fadeOut(150),$(".js-edit-content").fadeOut(200),cms.jsContainer.find("li.editing").removeClass("editing")})},loginIn:function(){$(".js-login-form").on("submit",function(t){var e=$(this).serialize();$.ajax({type:"POST",url:cms.apiPath,data:e,success:function(t){0==t?location.reload():$(".js-login-error").slideDown()}}),t.preventDefault()})},saveSettings:function(){cms.jsContainer.on("submit",".js-settings-form",function(t){var e=$(this).serialize();cms.showSavingIndicator(),$.ajax({type:"POST",url:cms.apiPath,data:e,success:function(){}}),t.preventDefault()})},saveContent:function(){cms.jsContainer.on("submit",".js-content-form",function(t){var e=$(this).serialize();cms.showSavingIndicator(),$.ajax({type:"POST",url:cms.apiPath,data:e,success:function(){}}),t.preventDefault()})},setContainerWidth:function(){wWidth=$(window).width(),cms.jsContainer.width(wWidth-140)},changePage:function(t){cms.jsContainer.load(t,function(){cms.placeDescTooltip()})},createNewContent:function(){$(".js-createNew-btn").on("click",function(t){var e=$(".js-create-title").val(),n=$(".js-create-id").val(),i=$(".js-create-content").val(),s=$(".js-create-description").val(),a=Math.round((new Date).getTime()/1e3);descState=s.length<=0?"none":"block",cms.validateData(".js-createNew-btn"),cms.validate&&(cms.jsContainer.find(".list li.no-content").remove(),0==cms.jsContainer.find(".list li").length&&cms.jsContainer.find(".list").after("<input type='submit' class='save-progress' value='Save'>"),cms.jsContainer.find(".list").prepend("<li data-articleid='"+n+"'>"+"<span class='content-title'><span class='content-title__inside'><span class='js-content-title'>"+e+"</span><div style='display:"+descState+"' class='description_icon js-show-desc'><span class='icon-question-sign'></span></div><div class='description_content js-desc-text'><p>"+s+"</p></div></span></span>"+"<input type='hidden' placeholder='title' class='js-title' name='title[]' value='"+e+"'>"+"<input type='hidden' placeholder='id' class='js-id' name='id[]' value='"+n+"'>"+"<input type='text' class='content-input' placeholder='content' name='content[]' value='"+i+"'>"+"<input type='hidden' placeholder='description' class='js-description' name='description[]' value='"+s+"'>"+"<input type='hidden' name='time[]' value='"+a+"'>"+"<div class='edit js-edit'><span class='icon-pencil'></span></div>"+"</li>"),$(".js-create-new").fadeOut(200),$(".overlay").fadeOut(150),$("#panel").submit(),$('.js-create-new input[type="text"]').val("")),t.preventDefault()})},editContent:function(){cms.jsContainer.on("click",".js-edit",function(){$(this).parent().addClass("editing");var t=$(this).parent(),e=$(".js-edit-content"),n=t.find(".js-description").val(),i=t.find(".js-title").val(),s=t.find(".js-id").val();e.find(".js-description").val(n),e.find(".js-title").val(i),e.find(".js-id").val(s),e.fadeIn(200),$(".overlay").fadeIn(150)})},saveEditedContent:function(){$(".js-editContent-btn").on("click",function(){var t=cms.jsContainer.find("li.editing"),e=$(".js-edit-content"),n=e.find(".js-description").val(),i=e.find(".js-title").val(),s=e.find(".js-id").val();cms.validateData(".js-editContent-btn"),cms.validate&&(t.find(".js-description").val(n),t.find(".js-title").val(i),t.find(".js-id").val(s),t.find(".js-content-title").html(i),t.find(".js-desc-text p").html(n),e.fadeOut(200),$(".overlay").fadeOut(150),$("#panel").submit(),$("body input").removeClass("error"),cms.jsContainer.find("li.editing").removeClass("editing"))})},placeDescTooltip:function(){$("body div").each(function(){var t=$(this).find(".description_content").height();$(this).find(".description_content").css({top:-(t/2)})})},deleteArticle:function(t){$.ajax({type:"POST",url:cms.apiPath,data:"delete="+t,success:function(){0==cms.jsContainer.find(".list li").length&&(cms.jsContainer.find(".save-progress").remove(),cms.jsContainer.find(".list").prepend("<li class='no-content'>No content yet! Create one by clicking the <span class='icon-plus js-create'></span> icon. </li>"))}})},showSavingIndicator:function(){$(".save-progress").addClass("saving"),setTimeout(function(){$(".save-progress").removeClass("saving")},500)},suggetsId:function(){var t=$(".js-create-title"),e=$(".js-create-id");t.keyup(function(){var t=$(this).val();str=t.replace(/\s/g,"-"),e.val(str.toLowerCase()),cms.validateID(str.toLowerCase())})},validateData:function(t){var e=$(t).parent();e.find("input").each(function(){if($(this).is(".required")){var t=$(this).data("valtype");if("text"==t){var e=$(this).val();1>=e?($(this).addClass("error"),cms.validate=!1):cms.validate=!0}}})},validateID:function(t){$(".js-create-id").removeClass("error"),$.ajax({type:"POST",url:cms.apiPath,data:"sugg-id=true&new-id="+t,success:function(t){/1/.test(t)?$(".js-create-id").addClass("error"):$(".js-create-id").removeClass("error")}})}};